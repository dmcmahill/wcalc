# $Id: Makefile.in,v 1.6 2001/09/12 23:51:48 dan Exp $

#
# Copyright (c) 2001 Dan McMahill
# All rights reserved.
#
# This code is derived from software written by Dan McMahill
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
# 3. All advertising materials mentioning features or use of this software
#    must display the following acknowledgement:
#        This product includes software developed by Dan McMahill
#  4. The name of the author may not be used to endorse or promote products
#     derived from this software without specific prior written permission.
# 
#  THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
#  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
#  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
#  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
#  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
#  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
#  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED
#  AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
#  OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
#  OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
#  SUCH DAMAGE.
#

default: all

@SET_MAKE@


prefix      = @prefix@
exec_prefix = @exec_prefix@
srcdir      = @srcdir@
VPATH       = @srcdir@

bindir   = $(exec_prefix)/bin
mandir   = @mandir@
sharedir = ${prefix}/share


INSTALL         = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_SCRIPT  = @INSTALL_SCRIPT@
INSTALL_DATA    = @INSTALL_DATA@

AWK     = @AWK@
CC      = @CC@
CFLAGS  = @CFLAGS@ -I$(srcdir)/..
LDFLAGS = @LDFLAGS@

LIBS    = @LIBS@ -lm


HTML2C  = ${AWK} -f ../html2c out=cgiOut 
HTML2ID = $(AWK) '/\$$.*\$$/ {printf("const char id_string[]=\"%s\";\n",gensub(/.*(\$$.*\$$).*/,"\\1","g"));}'

PROGS = ic_microstrip.cgi \
	microstrip.cgi


../mathutil.o: $(srcdir)/../mathutil.c
	cd .. && $(MAKE) mathutil.o

footer_html.c:	footer.html
	$(HTML2C) $(srcdir)/footer.html > $(srcdir)/footer_html.c


###########################################
#
# ic_microstrip.cgi

IC_MICROSTRIP_CGI_CFILES=	ic_microstrip.cgi.c \
				cgic.c 

IC_MICROSTRIP_CGI_OFILES=	${IC_MICROSTRIP_CGI_CFILES:.c=.o} \
				../ic_microstrip.o \
				../mathutil.o 

../ic_microstrip.o: $(srcdir)/../ic_microstrip.c
	cd .. && $(MAKE) ic_microstrip.o


ic_microstrip_html.c:	ic_microstrip.html
	$(HTML2C) $(srcdir)/ic_microstrip.html > $(srcdir)/ic_microstrip_html.c

ic_microstrip_id.h: ic_microstrip.html
	$(HTML2ID) $(srcdir)/ic_microstrip.html >> $(srcdir)/ic_microstrip_id.h

ic_microstrip.cgi.o: ic_microstrip.cgi.c ic_microstrip_html.c footer_html.c ic_microstrip_id.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/ic_microstrip.cgi.c

ic_microstrip.cgi:  $(IC_MICROSTRIP_CGI_OFILES)
	$(CC) $(CFLAGS) -o $@ $(IC_MICROSTRIP_CGI_OFILES) $(LDFLAGS) $(LIBS)

#
###########################################

###########################################
#
# microstrip.cgi

MICROSTRIP_CGI_CFILES=	microstrip.cgi.c \
			cgic.c 

MICROSTRIP_CGI_OFILES=	${MICROSTRIP_CGI_CFILES:.c=.o} \
			../microstrip.o \
			../mathutil.o 

../microstrip.o: $(srcdir)/../microstrip.c
	cd .. && $(MAKE) microstrip.o


microstrip_html.c:	microstrip.html
	$(HTML2C) $(srcdir)/microstrip.html > $(srcdir)/microstrip_html.c

microstrip_id.h: microstrip.html
	$(HTML2ID) $(srcdir)/microstrip.html >> $(srcdir)/microstrip_id.h

microstrip.cgi.o: microstrip.cgi.c microstrip_html.c footer_html.c microstrip_id.h
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/microstrip.cgi.c

microstrip.cgi:  $(MICROSTRIP_CGI_OFILES)
	$(CC) $(CFLAGS) -o $@ $(MICROSTRIP_CGI_OFILES) $(LDFLAGS) $(LIBS)

#
###########################################


clean:
	-rm *.o *.mat *~ $(PROGS)

distclean: clean
	-rm configure config.log config.cache config.status


###########################################
# the program
#
all:: $(PROGS)

install:: install.bin

install.bin:: $(PROGS) installdirs
	@#$(INSTALL_PROGRAM) $(PROGS) ${prefix}/bin/$(PROG)

#
###########################################

###########################################
# The install directories
#

install:: installdirs

installdirs: mkinstalldirs
	@#$(srcdir)/mkinstalldirs $(bindir) $(mandir)/man1 $(mandir)/cat1 \

#
###########################################

###########################################
# The man page
install:: install.man

install.man: installdirs
	@#$(INSTALL_DATA) $(srcdir)/wcalc.1 $(mandir)/man1/wcalc.1

#
###########################################

###########################################
# the build stuff
#all:: configure Makefile


#Makefile: Makefile.in ../config.status
#	cd .. && ./config.status

#../config.status: ../configure
#	cd .. && ./configure

#
###########################################


